---
title: 'Lab #03: Probability and Teamwork'
subtitle: 'due Wednesday, September 15, 4:00 PM'
output:
  tufte::tufte_html:    
    css: "sta199-labs.css"
    tufte_variant: envisioned
    highlight: pygments
    toc: no
    toc_depth: 1
  html_document:
    toc: no
    toc_depth: '1'
    df_print: paged
link-citations: yes
editor_options:
  chunk_output_type: console
---

## Goals

- Practice collaboration using the data science workflow
- Use probability to explore global health data

# Getting started

Log in to GitHub to determine your team number and members for Lab 3.

- Introduce yourself.
- Find a one hour block of time outside of class that you can use to work on the
lab / project if needed. You may not need to use this, but it is good to have it
in reserve. Tools like [Doodle](https://doodle.com/en/)
and [When2Meet](https://www.when2meet.com/) are helpful.
- Determine how your group will communicate (email, text, slack, discord, etc).

Every team member should now go to the course GitHub organization and locate 
your lab 3 repository, which should have the prefix **lab03**. Copy the URL of
the repository and clone in RStudio. If you have trouble, see the first lab for step-by-step instructions or ask a teammate for help.

Then, configure git in the **console** as we have done in previous labs, using
your GitHub username and email address.

**Do not edit the `.Rmd` file until explicitly asked to do so in the instructions.**


```{r eval=FALSE}
library(usethis)
use_git_config(user.name = "GitHub username", user.email="your email")
```

# Preterm Birth

Just over 1 in 10 babies worldwide are born too soon, and the preterm birth rate has been increasing in most countries, according to the [Global Action Report on Preterm Birth](https://www.who.int/pmnch/media/news/2012/201204_borntoosoon-execsum-eng.pdf?ua=1). In the poorest countries, roughly 12% of births are preterm, while this rate is only 9% in the highest income countries. Within countries, poorer families are at higher risk. Because preterm birth is associated with increased risk of morbidity and mortality, it is important to offer better pre-conception and pregnancy healthcare to reduce the likelihood an infant is born too early.

We consider 10,000 observations from a random sample of births in three countries. Variables include `preterm` (which takes values *preterm* for births < 37 weeks and *term* for births $\geq$ 37 weeks) and `country` (Malawi, Nigeria, or South Africa).

```{r gendata, echo=FALSE, eval=FALSE}
# now saved in preterm.Rdata in keys repo; don't run this
rep.row<-function(x,n){
    matrix(rep(x,each=n),nrow=n)
}
library(tidyverse)
ptb=data.frame(rbind(rep.row(c("term","Malawi"),672),rep.row(c("preterm","Malawi"),148), rep.row(c("term","Nigeria"),6901),rep.row(c("preterm","Nigeria"),959), rep.row(c("term","South Africa"),1214),rep.row(c("preterm","South Africa"),106)))

names(ptb)[1]<-"PTBstatus"
names(ptb)[2]<-"Country"

rows <- sample(nrow(ptb))

preterm <- ptb[rows,]

rownames(preterm) <- NULL

save(preterm,file="preterm.Rdata")

```


# Team workflow

Assign each team member a number 1 through 3 and write your number down on a 
piece of paper. This lab will walk you through the basics of team workflow 
step-by-step. If your team has just two members, then team member 1 should complete the first task (item 4) of member 3, and team member 2 should complete the other tasks of member 3.

**Do the following exercises in order, following each step carefully.**

**Only one person at a time should type in the `.Rmd` file and push updates.**

**The person working should share their screen, and the others should follow along.**

<span style="color: red;">**Team member 1:**</span> Open the `lab3.Rmd` file 
and change the author of the YAML header to the following "Team Number:
Member 1, Member 2, Member 3" with your team number (for example Team 3) and the
first and last names of all team members.

<span style="color: red;">**Team member 1:**</span> Run the `load-data` code 
chunk to read in the data and print the first six rows. Share the results with 
your team members. Then, answer the questions below.

```{r load-data, message=FALSE}
library(tidyverse)
load("preterm.Rdata")
head(preterm,2) #you'll want to modify this line!
```


1. Compute the probability that a baby in the study was born in Nigeria. Do the same for South Africa and for Malawi. Summarize your results in a table directly generated by R, using informative variable names.

```{r ex1}
preterm %>%
  group_by(Country) %>%
  summarize(renamethis=n()) %>% #to summarize count
  mutate(moreinformativename=renamethis/sum(renamethis)) #getting prob
```

2. Compute the conditional probability that a baby born in Nigeria was born preterm. Do the same for babies born in South Africa and in Malawi, respectively. Summarize your results in a table directly generated by R, using informative variable names. Include a sentence or two describing your findings.



<span style="color: red;">**Team member 1:**</span> When you have finished,
knit to PDF, then stage, commit, and push your `.Rmd` and PDF to GitHub with an
appropriate commit message.

<span style="color: red;">**All other team members:**</span> Once your team 
member has pushed the work, pull to get the updated documents from GitHub. Click
on the `.Rmd` file and you should see the responses to the first two exercises. Knit the file to update your own documents.

<span style="color: red;">**Team member 2:**</span> It's your turn. Answer the
question below.

3. Create a segmented bar chart, with each bar going from 0-1, with the country names along the y-axis and horizontal bars illustrating the fraction of term and preterm births for each country. Use informative labels and titles.



<span style="color: red;">**Team member 2:**</span> Knit to PDF, then stage, 
commit, and push your `.Rmd` and PDF to GitHub with an appropriate commit 
message.

<span style="color: red;">**All other team members:**</span> Once your team 
member has pushed the work, pull to get the updated documents from GitHub. Click
on the `.Rmd` file and you should see the responses to the first three exercises. Knit the file.

<span style="color: red;">**Team member 3:**</span> It's your turn. Complete the
exercise below.

4. Given that a baby in the study is preterm, what is the probability it was born in Malawi?  Calculate this conditional probability along with the corresponding probabilities that a preterm baby was born in Nigeria and that a preterm baby was born in South Africa. 
Summarize your results in a table directly generated by R (a tibble is fine) as well as in an informative bar plot. Include a sentence describing your results in comparison to those from the first exercise.

<span style="color: red;">**Team member 3:**</span> Knit to PDF, then stage,
commit, and push your `.Rmd` and PDF to GitHub with an appropriate commit
message.

<span style="color: red;">**All other team members:**</span> Once your team 
member has pushed the work, pull to get the updated documents from GitHub. Click 
on the `.Rmd` file and you should see the responses to the first four exercises.
Knit the file.

<span style="color: red;">**Team member 1:**</span> It's your turn. Complete the
exercise below.

5. Are the two random variables `Country` and `PTBstatus` independent, or not?  Provide numeric calculations to support your answer.


<span style="color: red;">**Team member 1:**</span> Knit to PDF, then stage, 
commit, and push your `.Rmd` and PDF to GitHub with an appropriate commit 
message.

<span style="color: red;">**All other team members:**</span> Once your team 
member has pushed the work, pull to get the updated documents from GitHub. Click 
on the `.Rmd` file and you should see the responses to the first five 
exercises. Knit the file.

<span style="color: red;">**Team member 2:**</span> Almost done! Your job is to explore the preterm birth rate in Malawi relative to that overall in poorer nations. 

6. Suppose you want to quantify how different the preterm birth rate in Malawi is from the preterm birth rate in poorer countries (12%). Let's assume (before seeing the data!) that the preterm birth rate in Malawi is 12%, and that the # of preterms out of a fixed number of births in Malawi is a binomial random variable. Under this distribution, how many preterm births would you expect to see in a sample of 820 births in Malawi?  In addition, what is the probability in a sample of 820 births (what we had in Malawi) that we would see 148 (our number) or more preterms, if the true preterm birth probability were 0.12?  CODING TIP: you can use R to print output inline; see [Section 3.1 here](https://bookdown.org/yihui/rmarkdown-cookbook/r-code.html) for details.




<span style="color: red;">**Team member 2:**</span>  Check to confirm all code
chunks are named and all code
follows the tidyverse style guidelines. Make changes as necessary.

<span style="color: red;">**Team member 2:**</span> When you have finished,
knit to PDF, then stage, commit, and push your `.Rmd` and PDF to GitHub with an
appropriate commit message.

<span style="color: red;">**All other team members:**</span> Once your team 
member has pushed the work, pull to get the updated documents from GitHub. Click
on the `.Rmd` file to see your final version of the lab. 

<span style="color: red;">**Team member 3:**</span> Upload your team's PDF to
Gradescope. Include every team member's name in the Gradescope submission and
identify which problems are on each page in Gradescope. Associate the "Overall"
section with the first page of your PDF.

There should only be one submission per team on Gradescope.



## Grading
Total: 50 pts

- Exercise 1: 7 pts
- Exercise 2: 7 pts
- Exercise 3: 7 pts
- Exercise 4: 7 pts
- Exercise 5: 7 pts
- Exercise 6: 7 pts
- Overall:  8 pts

  - Overall includes the number of commits made by different team members (at least 2 by members 1 and 2 and 1 by member 3, modified if you only have 2 on your team of course), naming chunks, updating the names on the assignment to your team name clearly identifying all team members, following tidyverse style (see: https://style.tidyverse.org/), and in general producing a nicely formatted, neat report. 